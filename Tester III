-- Remove any previous instances of the script GUI or ESP elements
if game.CoreGui:FindFirstChild("HitboxAndESPGui") then
    game.CoreGui.HitboxAndESPGui:Destroy()
end

if game.CoreGui:FindFirstChild("ESPHolder") then
    game.CoreGui.ESPHolder:Destroy()
end

-- Settings for Hitbox and ESP
getgenv().HitboxSize = 15
getgenv().HitboxTransparency = 0.9
getgenv().HitboxStatus = false
getgenv().TeamCheck = false
getgenv().filluseteamcolor = true
getgenv().outlineuseteamcolor = true
getgenv().fillcolor = Color3.new(0, 0, 0)
getgenv().outlinecolor = Color3.new(1, 1, 1)
getgenv().filltrans = 0.5
getgenv().outlinetrans = 0.5

-- Create a ScreenGui for the toggles
local ScreenGui = Instance.new("ScreenGui")
local HitboxAndESPButton = Instance.new("TextButton")
local TeamCheckButton = Instance.new("TextButton")

ScreenGui.Name = "HitboxAndESPGui"
ScreenGui.Parent = game.CoreGui

-- Hitbox and ESP Toggle Button
HitboxAndESPButton.Name = "HitboxAndESPToggle"
HitboxAndESPButton.Parent = ScreenGui
HitboxAndESPButton.BackgroundColor3 = Color3.fromRGB(75, 151, 75)
HitboxAndESPButton.Position = UDim2.new(0.1, 0, 0.1, 0)
HitboxAndESPButton.Size = UDim2.new(0, 200, 0, 50)
HitboxAndESPButton.Font = Enum.Font.SourceSans
HitboxAndESPButton.Text = "Hitbox & ESP: OFF"
HitboxAndESPButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HitboxAndESPButton.TextScaled = true

-- Team Check Toggle Button
TeamCheckButton.Name = "TeamCheckToggle"
TeamCheckButton.Parent = ScreenGui
TeamCheckButton.BackgroundColor3 = Color3.fromRGB(75, 151, 75)
TeamCheckButton.Position = UDim2.new(0.1, 0, 0.2, 0)
TeamCheckButton.Size = UDim2.new(0, 200, 0, 50)
TeamCheckButton.Font = Enum.Font.SourceSans
TeamCheckButton.Text = "Team Check: OFF"
TeamCheckButton.TextColor3 = Color3.fromRGB(255, 255, 255)
TeamCheckButton.TextScaled = true

-- Function to update hitbox size and ESP
local function updateHitboxAndESP()
    local holder = game.CoreGui:FindFirstChild("ESPHolder") or Instance.new("Folder")
    holder.Name = "ESPHolder"
    holder.Parent = game.CoreGui

    for i, v in pairs(game:GetService('Players'):GetPlayers()) do
        if v ~= game.Players.LocalPlayer then
            if getgenv().HitboxStatus == true and (not getgenv().TeamCheck or v.Team ~= game.Players.LocalPlayer.Team) then
                -- Update Hitbox
                pcall(function()
                    v.Character.HumanoidRootPart.Size = Vector3.new(getgenv().HitboxSize, getgenv().HitboxSize, getgenv().HitboxSize)
                    v.Character.HumanoidRootPart.Transparency = getgenv().HitboxTransparency
                    v.Character.HumanoidRootPart.BrickColor = BrickColor.new("Really black")
                    v.Character.HumanoidRootPart.Material = "Neon"
                    v.Character.HumanoidRootPart.CanCollide = false
                end)

                -- Update ESP
                local chr = v.Character
                if chr ~= nil then
                    local esp = holder:FindFirstChild(v.Name) or Instance.new("Highlight")
                    esp.Name = v.Name
                    if v.Name ~= game.Players.LocalPlayer.Name then
                        esp.Parent = holder
                        if getgenv().filluseteamcolor then
                            esp.FillColor = v.TeamColor.Color
                        else
                            esp.FillColor = getgenv().fillcolor
                        end
                        if getgenv().outlineuseteamcolor then
                            esp.OutlineColor = v.TeamColor.Color
                        else
                            esp.OutlineColor = getgenv().outlinecolor
                        end
                        esp.FillTransparency = getgenv().filltrans
                        esp.OutlineTransparency = getgenv().outlinetrans
                        esp.Adornee = chr
                        esp.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                    end
                end
            else
                -- Reset hitbox and remove ESP
                pcall(function()
                    v.Character.HumanoidRootPart.Size = Vector3.new(2, 2, 1)
                    v.Character.HumanoidRootPart.Transparency = 1
                    v.Character.HumanoidRootPart.BrickColor = BrickColor.new("Medium stone grey")
                    v.Character.HumanoidRootPart.Material = "Plastic"
                    v.Character.HumanoidRootPart.CanCollide = true
                end)

                if holder:FindFirstChild(v.Name) then
                    holder:FindFirstChild(v.Name):Destroy()
                end
            end
        end
    end
end

-- Toggle Hitbox and ESP Button Functionality
HitboxAndESPButton.MouseButton1Click:Connect(function()
    getgenv().HitboxStatus = not getgenv().HitboxStatus
    if getgenv().HitboxStatus then
        HitboxAndESPButton.Text = "Hitbox & ESP: ON"
    else
        HitboxAndESPButton.Text = "Hitbox & ESP: OFF"
    end
    updateHitboxAndESP()
end)

-- Toggle Team Check Button Functionality
TeamCheckButton.MouseButton1Click:Connect(function()
    getgenv().TeamCheck = not getgenv().TeamCheck
    if getgenv().TeamCheck then
        TeamCheckButton.Text = "Team Check: ON"
    else
        TeamCheckButton.Text = "Team Check: OFF"
    end
    updateHitboxAndESP()
end)

-- Constantly update hitboxes and ESP every frame
game:GetService('RunService').RenderStepped:Connect(updateHitboxAndESP)
